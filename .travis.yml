env:
  global:
    - REPO_DIR=.
    # Commit from your-project that you want to build
    - BUILD_COMMIT=
    # pip dependencies to _build_ your project
    - BUILD_DEPENDS=""
    # pip dependencies to _test_ your project.  Include any dependencies
    # that you need, that are also specified in BUILD_DEPENDS, this will be
    # a separate install.
    - TEST_DEPENDS="nose"
    - PLAT=x86_64
    - UNICODE_WIDTH=32
    - MULTIBUILD_TARBALL_URL=https://github.com/matthew-brett/multibuild/tarball/e6ebbfa42588c26579eff99c50e84326dd9f6b3e
    - S3BUCKET=pythonwheelhouse

language: python
# The travis Python version is unrelated to the version we build and test
# with.  This is set with the MB_PYTHON_VERSION variable.
python: 3.5
sudo: required
dist: trusty
services: docker

matrix:
  exclude:
    # Exclude the default Python 3.5 build
    - python: 3.5
  include:
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.6
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.6
        - PLAT=i686
    - os: linux
      env: MB_PYTHON_VERSION=2.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.3
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.3
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.4
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.4
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.6
        - PLAT=i686
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=2.7
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.4
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.5
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.6

before_install:
    - (mkdir -p ~/multibuild && cd ~/multibuild && curl --location "$MULTIBUILD_TARBALL_URL" | tar -xzvf - --strip 1)
    - source ~/multibuild/common_utils.sh
    - source ~/multibuild/travis_steps.sh
    - before_install

install:
    - build_wheel $REPO_DIR $PLAT

script:
    - install_run $PLAT

after_success:
    - pip install https://github.com/joerick/libcloud/archive/v1.5.0-s3fix.zip wheelhouse_uploader certifi
    - python -m wheelhouse_uploader upload --provider-name=S3_EU_WEST --local-folder ${TRAVIS_BUILD_DIR}/wheelhouse/ $S3_BUCKET
